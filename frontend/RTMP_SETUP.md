# RTMP Server Setup for StreamGuard

## Quick Setup with Docker (Recommended)

### 1. Using Simple Relay Server (SRS)

```bash
# Run SRS RTMP server
docker run --rm -it -p 1935:1935 -p 8080:8080 ossrs/srs:5

# Or with custom config
docker run --rm -it -p 1935:1935 -p 8080:8080 \
  -v $(pwd)/srs.conf:/usr/local/srs/conf/srs.conf \
  ossrs/srs:5
```

### 2. Using nginx-rtmp

```bash
# Create nginx.conf
cat > nginx.conf << 'EOF'
events {
    worker_connections 1024;
}

rtmp {
    server {
        listen 1935;
        chunk_size 4096;
        
        application live {
            live on;
            
            # Enable HLS
            hls on;
            hls_path /tmp/hls;
            hls_fragment 3;
            hls_playlist_length 60;
            
            # Allow publishing from any IP
            allow publish all;
            allow play all;
        }
    }
}

http {
    server {
        listen 8080;
        
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            root /tmp;
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
        }
    }
}
EOF

# Run nginx-rtmp
docker run --rm -it -p 1935:1935 -p 8080:8080 \
  -v $(pwd)/nginx.conf:/etc/nginx/nginx.conf \
  tiangolo/nginx-rtmp
```

## Environment Configuration

Create a `.env` file in the frontend directory:

```env
# Walrus Configuration
VITE_WALRUS_PUBLISHER_URL=https://publisher.walrus-testnet.walrus.space
VITE_WALRUS_AGGREGATOR_URL=https://aggregator.walrus-testnet.walrus.space

# RTMP Server Configuration
VITE_RTMP_SERVER_URL=rtmp://localhost:1935/live
VITE_RTMP_SERVER_HOST=localhost
VITE_RTMP_SERVER_PORT=1935

# Sui Network Configuration
VITE_SUI_NETWORK=testnet
VITE_SUI_RPC_URL=https://fullnode.testnet.sui.io:443
```

## OBS Studio Configuration

1. **Open OBS Studio**
2. **Go to Settings > Stream**
3. **Configure as follows:**
   - Service: Custom
   - Server: `rtmp://localhost:1935/live`
   - Stream Key: `[Use the key generated by StreamGuard]`

## Testing the Setup

1. Start your RTMP server using one of the methods above
2. Create a stream in StreamGuard
3. Copy the RTMP URL and Stream Key
4. Configure OBS with these credentials
5. Start streaming in OBS
6. The stream should appear as "Live" in StreamGuard

## Production Deployment

For production, consider using:
- **AWS MediaLive** for managed RTMP ingestion
- **Cloudflare Stream** for global RTMP endpoints
- **Custom server** with nginx-rtmp on cloud infrastructure

## Troubleshooting

### "Failed to connect to server" in OBS
- Ensure RTMP server is running on port 1935
- Check firewall settings
- Verify the RTMP URL format: `rtmp://host:port/application`

### Stream not appearing as live
- Check that the stream key matches
- Verify the RTMP server is receiving the stream
- Check browser console for errors

### Poor streaming quality
- Adjust OBS encoding settings
- Use hardware encoding if available
- Optimize bitrate for your upload speed 